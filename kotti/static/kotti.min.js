var kotti={dom_changed_handlers:new Array()};var jq=jQuery;(function(a){a.fn.find2=function(b){return this.filter(b).add(this.find(b))};kotti.replace_html=function(d){var c=a(d);var b=null;var e=null;c.find2(".ajax-replace").each(function(){if(this.id==""){throw"Found .ajax-replace elemnt without id: "+this}b="#"+this.id;a(b).replaceWith(this);e=a(b);kotti.dom_changed(e)})};kotti.ajax_forms=function(b){b.find2("form.ajax").ajaxForm({success:kotti.replace_html})};kotti.dirty_forms=function(d){var b=a("form").not("[class~=dirty-ignore]");a(window).unbind("beforeunload");b.submit(function(){a(window).unbind("beforeunload")});if(tinyMCE!=undefined){tinyMCE.triggerSave(true)}var c=b.serialize();a(window).bind("beforeunload",function(){if(tinyMCE!=undefined){tinyMCE.triggerSave(true)}if(a("form").serialize()!=c){return"Your changes have not been saved.\nAre you sure you want to leave this page?"}return null})};kotti.collapse=function(b){b.find2(".collapse").each(function(){a(this).find(".collapseme").hide();function c(){a(this).find(".collapseme").show()}a(this).click(c);a(this).hover(c)})};kotti.hover_link_enable=function(b){b.find2(".hover-link").removeClass("hover-link");b.find2(".hover-link-enable").hover(function(){a(this).addClass("hover-link")},function(){a(this).removeClass("hover-link")}).click(function(){var c=a("a",a(this));var d=c.attr("target");if(!d){d="_self"}window.open(c.attr("href"),d);return false})};kotti.dom_changed=function(b){a.each(kotti.dom_changed_handlers,function(c,d){d(b)})};kotti.main=function(b){var c=a("html");if(!b){b=[kotti.ajax_forms,kotti.collapse,kotti.hover_link_enable]}a.each(b,function(d,e){kotti.dom_changed_handlers.push(e)});kotti.dom_changed(c)};deform.load();kotti.main()})(jQuery);