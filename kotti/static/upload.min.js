var app=angular.module("kotti",[]);app.filter("bytes",function(){return function(b,a){if(isNaN(parseFloat(b))||!isFinite(b)){return"-"}if(typeof a==="undefined"){a=1}var c=["bytes","kB","MB","GB","TB","PB"];var d=Math.floor(Math.log(b)/Math.log(1024));if(!isFinite(d)){d=0}return(b/Math.pow(1024,Math.floor(d))).toFixed(a)+" "+c[d]}});function UploadController(a,c,b){b.info("Initializing UploadController...");a.files=[];a.errors=[];a.num_files_waiting=0;a.uploadAll=function(){a.uploader.uploadStoredFiles()};a.dismissError=function(d){a.errors.splice(a.errors.indexOf(d),1)};a.apply=function(e){var d=this.$root.$$phase;if(d=="$apply"||d=="$digest"){if(e&&(typeof(e)==="function")){e()}}else{this.$apply(e)}};a.uploader=new qq.FineUploaderBasic({debug:true,autoUpload:false,button:$("#btn-select-files")[0],element:document.getElementById("uploader"),request:{endpoint:null},callbacks:{onValidate:function(d){b.info("onValidate")},onSubmit:function(e,d){b.info("onSubmit");a.apply(function(){var f=a.uploader.getFile(e);c.get(a.endpoints.content_types,{params:{mimetype:f.type}}).success(function(j,g,l,h){var k=j.content_types;var i={id:e,name:d,size:a.uploader.getSize(e),file:a.uploader.getFile(e)};if(k.length===0){i.status="Error";i.error="There is no content type in this context that knows create items from that file type.";a.errors.splice(e,0,i);return false}i.status="ready for upload";i.transfered={bytes:0,percent:0};i.allowed_types=k;i.desired_type=k[0];a.files.splice(e,0,i);a.num_files_waiting++})})},onUpload:function(e,d){b.info("onUpload");a.apply(function(){a.files[e].status="uploading";a.uploader.setParams({content_type:a.files[e].desired_type.name},e);a.num_files_waiting--})},onProgress:function(g,d,e,f){a.apply(function(){a.files[g].transfered.bytes=e;a.files[g].transfered.percent=Math.round(e/f*100)})},onCancel:function(e,d){b.info("onCancel");a.apply(function(){a.files[e].status="cancelled"})},onError:function(f,e,d){b.info("onError");a.apply(function(){a.files[f].status="failed"});return false},onComplete:function(f,e,d){b.info("onComplete");a.apply(function(){if(a.files[f].status=="uploading"){a.files[f].status="complete";a.files[f].url=d.url}})}}});a.$watch("endpoints",function(d){a.uploader.setEndpoint(d.upload)});b.info("UploadController initialized.")};